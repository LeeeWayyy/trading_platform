name: Auto Request Code Review

# Automatically request reviews from @codex and @gemini-code-assist when PRs are opened
# This ensures we never forget to request automated code reviews
# See: docs/STANDARDS/GIT_WORKFLOW.md for review policy
#
# IMPORTANT: This workflow uses a Personal Access Token (PAT) to authenticate as your user account
# instead of github-actions[bot]. This makes comments/commits appear under your username.
#
# Setup required (one-time):
# 1. Create a fine-grained PAT at: https://github.com/settings/tokens?type=beta
#    - Repository access: Select this repository only
#    - Permissions: "Pull requests" â†’ Read and write, "Contents" â†’ Read
#    - Expiration: 90 days (set calendar reminder to rotate)
#
# 2. Store the PAT as a repository secret:
#    - Go to: Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret
#    - Name: USER_PR_TOKEN
#    - Value: <paste your PAT>
#
# 3. Security: Never commit the PAT directly. Rotate every 90 days.

on:
  pull_request:
    types: [opened, reopened, ready_for_review, synchronize]

permissions:
  pull-requests: write
  contents: read

jobs:
  request-reviews:
    name: Request automated code reviews
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Add comment requesting reviews
        env:
          GH_TOKEN: ${{ secrets.USER_PR_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          gh pr comment $PR_NUMBER --body "ðŸ¤– **Automated Review Request**

          @gemini-code-assist @codex please review this pull request and check for:
          - Code quality issues
          - Potential bugs or security vulnerabilities
          - Test coverage gaps
          - Documentation completeness
          - Compliance with project standards

          See [\`docs/STANDARDS/GIT_WORKFLOW.md\`](../docs/STANDARDS/GIT_WORKFLOW.md) for review policy.

          **All review feedback must be addressed before merging.**"

      - name: Summary
        run: |
          echo "âœ… Automatically requested reviews from @codex and @gemini-code-assist"
          echo "PR: #${{ github.event.pull_request.number }}"
          echo "Author: @${{ github.event.pull_request.user.login }}"
