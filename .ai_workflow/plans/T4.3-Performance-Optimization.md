# T4.3: Performance Optimization Plan

## Overview
Implement M5 and M7 fixes for feature cache pre-computation and web console connection pooling.

## M5: Feature Generation Blocks Request Loop

### Status
Feature caching via Redis is ALREADY implemented in signal_service:
- `FeatureCache` class exists in `libs/redis_client/`
- `SignalGenerator` accepts optional `feature_cache` parameter
- `signal_service/main.py` initializes Redis and FeatureCache at startup

### Remaining Work
Add feature pre-computation endpoint for day-start cache warming.

### Solution
1. Add `/api/v1/features/precompute` endpoint to signal_service
2. Accepts list of symbols and date
3. Pre-computes and caches features without generating signals
4. Can be called at market open via cron/scheduler

### Files
- `apps/signal_service/signal_generator.py` - Add `precompute_features()` method for cache warming
- `apps/signal_service/main.py` - Add precompute endpoint that uses the new method

### Test Cases
- `test_feature_precompute_endpoint.py` - Verify endpoint caches features
- `test_feature_precompute_cache_hit.py` - Subsequent signal generation uses cached features

## M7: Web Console Connection Pooling

### Problem
`render_audit_log()` creates new psycopg connection per render (line 662).
At high usage, this overwhelms database connection limits.

### Solution
1. Add connection pool initialization at module level
2. Use pool.getconn() / pool.putconn() pattern
3. Configure pool size via environment variables

### Files
- `apps/web_console/config.py` - Add pool configuration
- `apps/web_console/app.py` - Use connection pool in render_audit_log()

### Test Cases
- `test_web_console_pool_init.py` - Pool initializes correctly
- `test_web_console_pool_reuse.py` - Connections are reused

## Testing
- 2 tests for M5 feature pre-computation
- 2 tests for M7 connection pooling
