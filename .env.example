# ═══════════════════════════════════════════════════════════════════
# REQUIRED: Alpaca API Credentials
# ═══════════════════════════════════════════════════════════════════
# Get from: https://app.alpaca.markets/paper/dashboard/overview
ALPACA_API_KEY_ID=your_key_here
ALPACA_API_SECRET_KEY=your_secret_here
ALPACA_BASE_URL=https://paper-api.alpaca.markets/v2

# ═══════════════════════════════════════════════════════════════════
# REQUIRED: Database Configuration
# ═══════════════════════════════════════════════════════════════════
# Note: Use postgresql:// (not postgresql+psycopg://) for psycopg3 compatibility
# Port 5433 avoids conflict with local PostgreSQL installations on port 5432
DATABASE_URL=postgresql://trader:trader@localhost:5433/trader
POSTGRES_USER=trader
POSTGRES_PASSWORD=trader
POSTGRES_DB=trader
# Optional override for containers (docker-compose worker profiles)
DATABASE_URL_DOCKER=postgresql://trader:trader@postgres:5432/trader

# ═══════════════════════════════════════════════════════════════════
# REQUIRED: Redis Configuration
# ═══════════════════════════════════════════════════════════════════
# NOTE: Redis has no host port mapping for security.
# Services inside Docker network use: redis://redis:6379/0
# For local development outside Docker, you may need to add port mapping.
REDIS_URL=redis://localhost:6379/1  # DB 1 for OAuth2 sessions (DB 0 reserved for other services)
# Optional override for containers (docker-compose worker profiles)
REDIS_URL_DOCKER=redis://redis:6379/0

# Application Configuration
STRATEGY_ID=alpha_baseline
DRY_RUN=true

# Data Pipeline Configuration
DATA_FRESHNESS_MINUTES=30
OUTLIER_THRESHOLD=0.30

# Qlib Configuration (T2)
QLIB_DATA_DIR=./data/qlib_data
MLFLOW_TRACKING_URI=file:./artifacts/mlruns
MLFLOW_EXPERIMENT_NAME=alpha_baseline

# Orchestrator Configuration (T5)
SIGNAL_SERVICE_URL=http://localhost:8001
EXECUTION_GATEWAY_URL=http://localhost:8002
ORCHESTRATOR_URL=http://localhost:8003
CAPITAL=100000
MAX_POSITION_SIZE=20000

# Slice Recovery Settings
MISFIRE_GRACE_SECONDS=60
STALE_SLICE_EXPIRY_SECONDS=86400  # Max age for slice recovery (24h default, 0 to disable)

# ═══════════════════════════════════════════════════════════════════
# API Authentication (C6)
# ═══════════════════════════════════════════════════════════════════
# Controls authentication mode for trading API endpoints (/api/v1/orders, /api/v1/signals)
# SECURITY: Defaults to enforce (fail-closed). Only use log_only for staged rollout.
API_AUTH_MODE=enforce  # enforce | log_only

# ═══════════════════════════════════════════════════════════════════
# Internal Service Authentication (X-Internal-Token)
# ═══════════════════════════════════════════════════════════════════
# HMAC-SHA256 authentication for service-to-service calls
# SECURITY: Defaults to true (fail-closed). Set to false ONLY for development.
INTERNAL_TOKEN_REQUIRED=true  # true | false (default: true in production)
# Generate with: python3 -c "import secrets; print(secrets.token_hex(32))"
INTERNAL_TOKEN_SECRET=
INTERNAL_TOKEN_TIMESTAMP_TOLERANCE_SECONDS=300  # ±5 minutes for clock skew

# Paper Run Configuration (T6)
# Defaults for scripts/paper_run.py automation
PAPER_RUN_SYMBOLS=AAPL,MSFT,GOOGL
PAPER_RUN_CAPITAL=100000
PAPER_RUN_MAX_POSITION_SIZE=20000

# ═══════════════════════════════════════════════════════════════════
# REQUIRED: Web Console Configuration (for Docker Compose)
# ═══════════════════════════════════════════════════════════════════
# SECURITY: Change these credentials before deploying!
WEB_CONSOLE_USER=admin
WEB_CONSOLE_PASSWORD=changeme
# Dev-only RBAC defaults for web console headers
WEB_CONSOLE_DEV_ROLE=admin
WEB_CONSOLE_DEV_USER_ID=admin
# Dev-only session version for manual controls (must match user_roles.session_version)
WEB_CONSOLE_DEV_SESSION_VERSION=1
# Comma-separated strategy IDs (optional for admin)
WEB_CONSOLE_DEV_STRATEGIES=

# Web Console Feature Flags (dev only)
FEATURE_HEALTH_MONITOR=true
FEATURE_RISK_DASHBOARD=false
FEATURE_STRATEGY_COMPARISON=false
FEATURE_MANUAL_CONTROLS=false
FEATURE_BACKTEST_MANAGER=false
FEATURE_CIRCUIT_BREAKER=false
FEATURE_ALERTS=false

# ═══════════════════════════════════════════════════════════════════
# LOGGING
# ═══════════════════════════════════════════════════════════════════
LOG_LEVEL=INFO

# OAuth2/OIDC Authentication (P2T3 Phase 3)
# Component 1: Auth0 configuration
AUTH0_DOMAIN=your-tenant.us.auth0.com
AUTH0_CLIENT_ID=your_client_id_here
AUTH0_CLIENT_SECRET=your_client_secret_here
AUTH0_AUDIENCE=https://api.trading-platform.local

# Component 3: Session management
SESSION_COOKIE_NAME=trading_platform_session
# Generate with: python3 -c "import os, base64; print(base64.b64encode(os.urandom(32)).decode())"
SESSION_ENCRYPTION_KEY=your_base64_encoded_32_byte_key_here
SESSION_COOKIE_MAX_AGE=3600
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Lax

# Component 6: mTLS Fallback (Admin-Only Emergency Authentication)
# WARNING: Only enable in production for Auth0 IdP outage scenarios
# Default: false (fallback disabled)
ENABLE_MTLS_FALLBACK=false

# Admin CN allowlist (comma-separated Common Names from client certificates)
# Example: MTLS_ADMIN_CN_ALLOWLIST=admin.trading-platform.local,emergency-admin.trading-platform.local
MTLS_ADMIN_CN_ALLOWLIST=

# CRL distribution point URL (Certificate Revocation List)
# Default: Internal CA CRL endpoint
MTLS_CRL_URL=http://ca.trading-platform.local/crl/admin-ca.crl

# ═══════════════════════════════════════════════════════════════════
# Alert Delivery Service (T7.5)
# ═══════════════════════════════════════════════════════════════════
# HMAC secret for hashing recipient identifiers in rate limit keys
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
ALERT_RECIPIENT_HASH_SECRET=your-secret-here-min-32-chars

# Operations Dashboard Dev Auth (P4T5 - Track 7)
# WARNING: NEVER set to true in production/staging
# Only allowed in: development, dev, local, test, ci
OPERATIONS_DEV_AUTH=false
