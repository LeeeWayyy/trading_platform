{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "system_map.config.schema",
  "title": "System Map Configuration",
  "description": "Schema for architecture visualization configuration",
  "type": "object",
  "required": ["version", "layers", "components"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema file"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the config schema"
    },
    "description": {
      "type": "string"
    },
    "layers": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "label", "order"],
        "properties": {
          "id": {"type": "string", "pattern": "^[a-z_]+$"},
          "label": {"type": "string"},
          "order": {"type": "integer", "minimum": 1}
        },
        "additionalProperties": false
      },
      "minItems": 1
    },
    "external_nodes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "label", "layer", "type"],
        "properties": {
          "id": {"type": "string", "pattern": "^ext_[a-z_]+$"},
          "label": {"type": "string"},
          "layer": {"type": "string"},
          "type": {"type": "string", "enum": ["api", "database", "monitoring"]},
          "spec": {"type": "string"}
        },
        "additionalProperties": false
      }
    },
    "components": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "required": ["layer", "spec"],
        "properties": {
          "layer": {"type": "string"},
          "spec": {"type": "string"}
        },
        "additionalProperties": false
      }
    },
    "virtual_edges": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["from", "to", "type"],
        "properties": {
          "from": {"type": "string"},
          "to": {"type": "string"},
          "type": {"type": "string", "enum": ["data_flow", "control", "event"]},
          "label": {"type": "string"}
        },
        "additionalProperties": false
      }
    },
    "filtering": {
      "type": "object",
      "properties": {
        "hide_to_common_libs": {"type": "boolean"},
        "common_libs": {"type": "array", "items": {"type": "string"}},
        "allowlist": {"type": "array", "items": {"type": "string"}}
      },
      "additionalProperties": false
    },
    "rendering": {
      "type": "object",
      "properties": {
        "flow_diagram": {"$ref": "#/$defs/output_config"},
        "deps_diagram": {"$ref": "#/$defs/output_config"},
        "canvas": {"$ref": "#/$defs/output_config"}
      },
      "additionalProperties": false
    }
  },
  "$defs": {
    "output_config": {
      "type": "object",
      "required": ["output"],
      "properties": {
        "output": {"type": "string"}
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
