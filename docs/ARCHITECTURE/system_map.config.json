{
  "$schema": "./system_map.schema.json",
  "version": "1.1.6",
  "description": "Configuration for architecture visualization generation",

  "layers": [
    {"id": "presentation", "label": "Presentation Layer", "order": 1},
    {"id": "orchestration", "label": "Orchestration", "order": 2},
    {"id": "core", "label": "Core Services", "order": 3},
    {"id": "domain", "label": "Domain Logic", "order": 4},
    {"id": "infra", "label": "Infrastructure", "order": 5}
  ],

  "subgroups": {
    "core": [
      {"id": "trading", "label": "Trading", "members": ["apps/signal_service", "apps/execution_gateway", "apps/market_data_service"]},
      {"id": "support", "label": "Support", "members": ["apps/model_registry", "apps/alert_worker", "apps/backtest_worker"]}
    ],
    "domain": [
      {"id": "data", "label": "Data", "members": ["libs/data", "libs/data/data_pipeline", "libs/data/data_providers", "libs/data/data_quality", "libs/data/market_data", "libs/duckdb_catalog"]},
      {"id": "ml", "label": "ML & Analytics", "members": ["libs/trading/alpha", "libs/models/factors", "libs/models", "libs/platform/analytics", "libs/trading/backtest"]},
      {"id": "risk", "label": "Risk & Allocation", "members": ["libs/trading/risk", "libs/trading/risk_management", "libs/trading/allocation", "libs/platform/tax"]},
      {"id": "strategies", "label": "Strategies", "members": ["strategies/alpha_baseline", "strategies/backtest", "strategies/ensemble", "research/strategies/mean_reversion", "research/strategies/momentum"]}
    ],
    "infra": [
      {"id": "auth", "label": "Auth", "members": ["libs/platform/admin", "libs/platform/web_console_auth", "libs/web_console_data", "libs/web_console_services"]},
      {"id": "core_libs", "label": "Core Libs", "members": ["libs/core", "libs/core/common", "libs/common", "libs/platform/secrets", "libs/core/health", "libs/core/redis_client", "libs/platform/alerts"]},
      {"id": "external", "label": "External Systems", "members": ["ext_alpaca", "ext_redis", "ext_postgres", "ext_prometheus", "ext_grafana"]}
    ]
  },

  "external_nodes": [
    {"id": "ext_alpaca", "label": "Alpaca API", "layer": "infra", "type": "api"},
    {"id": "ext_redis", "label": "Redis", "layer": "infra", "type": "database", "spec": "../SPECS/infrastructure/redis.md"},
    {"id": "ext_postgres", "label": "PostgreSQL", "layer": "infra", "type": "database", "spec": "../SPECS/infrastructure/postgres.md"},
    {"id": "ext_prometheus", "label": "Prometheus", "layer": "infra", "type": "monitoring", "spec": "../SPECS/infrastructure/prometheus.md"},
    {"id": "ext_grafana", "label": "Grafana", "layer": "infra", "type": "monitoring", "spec": "../SPECS/infrastructure/grafana.md"}
  ],

  "components": {
    "apps/web_console_ng": {"layer": "presentation", "spec": "../SPECS/services/web_console_ng.md"},
    "apps/auth_service": {"layer": "presentation", "spec": "../SPECS/services/auth_service.md"},

    "apps/orchestrator": {"layer": "orchestration", "spec": "../SPECS/services/orchestrator.md"},

    "apps/signal_service": {"layer": "core", "spec": "../SPECS/services/signal_service.md"},
    "apps/execution_gateway": {"layer": "core", "spec": "../SPECS/services/execution_gateway.md"},
    "apps/market_data_service": {"layer": "core", "spec": "../SPECS/services/market_data_service.md"},
    "apps/model_registry": {"layer": "core", "spec": "../SPECS/services/model_registry.md"},
    "apps/alert_worker": {"layer": "core", "spec": "../SPECS/services/alert_worker.md"},
    "apps/backtest_worker": {"layer": "core", "spec": "../SPECS/services/backtest_worker.md"},

    "libs/trading": {"layer": "domain", "spec": "../SPECS/libs/trading.md"},
    "libs/trading/allocation": {"layer": "domain", "spec": "../SPECS/libs/allocation.md"},
    "libs/trading/alpha": {"layer": "domain", "spec": "../SPECS/libs/alpha.md"},
    "libs/trading/backtest": {"layer": "domain", "spec": "../SPECS/libs/backtest.md"},
    "libs/trading/risk": {"layer": "domain", "spec": "../SPECS/libs/risk.md"},
    "libs/trading/risk_management": {"layer": "domain", "spec": "../SPECS/libs/risk_management.md"},

    "libs/models": {"layer": "domain", "spec": "../SPECS/libs/models.md"},
    "libs/models/factors": {"layer": "domain", "spec": "../SPECS/libs/factors.md"},

    "libs/data": {"layer": "domain", "spec": "../SPECS/libs/data.md"},
    "libs/data/data_pipeline": {"layer": "domain", "spec": "../SPECS/libs/data_pipeline.md"},
    "libs/data/data_providers": {"layer": "domain", "spec": "../SPECS/libs/data_providers.md"},
    "libs/data/data_quality": {"layer": "domain", "spec": "../SPECS/libs/data_quality.md"},
    "libs/data/market_data": {"layer": "domain", "spec": "../SPECS/libs/market_data.md"},
    "libs/duckdb_catalog": {"layer": "domain", "spec": "../SPECS/libs/duckdb_catalog.md"},

    "libs/platform": {"layer": "infra", "spec": "../SPECS/libs/platform.md"},
    "libs/platform/analytics": {"layer": "domain", "spec": "../SPECS/libs/analytics.md"},
    "libs/platform/tax": {"layer": "domain", "spec": "../SPECS/libs/tax.md"},
    "libs/platform/alerts": {"layer": "infra", "spec": "../SPECS/libs/alerts.md"},
    "libs/platform/admin": {"layer": "infra", "spec": "../SPECS/libs/admin.md"},
    "libs/platform/web_console_auth": {"layer": "infra", "spec": "../SPECS/libs/web_console_auth.md"},
    "libs/web_console_data": {"layer": "infra", "spec": "../SPECS/libs/web_console_data.md"},
    "libs/web_console_services": {"layer": "infra", "spec": "../SPECS/libs/web_console_services.md"},
    "libs/platform/secrets": {"layer": "infra", "spec": "../SPECS/libs/secrets.md"},

    "libs/core": {"layer": "infra", "spec": "../SPECS/libs/core.md"},
    "libs/core/common": {"layer": "infra", "spec": "../SPECS/libs/common.md"},
    "libs/common": {"layer": "infra", "spec": "../SPECS/libs/common.md"},
    "libs/core/redis_client": {"layer": "infra", "spec": "../SPECS/libs/redis_client.md"},
    "libs/core/health": {"layer": "infra", "spec": "../SPECS/libs/health.md"},

    "strategies/alpha_baseline": {"layer": "domain", "spec": "../SPECS/strategies/alpha_baseline.md"},
    "strategies/backtest": {"layer": "domain", "spec": "../SPECS/strategies/backtest.md"},
    "strategies/ensemble": {"layer": "domain", "spec": "../SPECS/strategies/ensemble.md"},
    "research/strategies/mean_reversion": {"layer": "domain", "spec": "../SPECS/strategies/mean_reversion.md"},
    "research/strategies/momentum": {"layer": "domain", "spec": "../SPECS/strategies/momentum.md"}
  },

  "virtual_edges": [
    {"from": "apps/orchestrator", "to": "apps/signal_service", "type": "data_flow", "label": "request signals"},
    {"from": "apps/signal_service", "to": "strategies/alpha_baseline", "type": "data_flow", "label": "compute alpha"},
    {"from": "apps/orchestrator", "to": "apps/execution_gateway", "type": "data_flow", "label": "execute orders"},
    {"from": "apps/execution_gateway", "to": "ext_alpaca", "type": "data_flow", "label": "submit orders"},
    {"from": "ext_alpaca", "to": "apps/execution_gateway", "type": "data_flow", "label": "order updates"},
    {"from": "apps/market_data_service", "to": "ext_redis", "type": "data_flow", "label": "publish quotes"},
    {"from": "ext_redis", "to": "apps/signal_service", "type": "data_flow", "label": "subscribe quotes"},
    {"from": "apps/web_console_ng", "to": "apps/execution_gateway", "type": "control", "label": "manual trading"},
    {"from": "apps/web_console_ng", "to": "ext_redis", "type": "data_flow", "label": "realtime updates"},
    {"from": "ext_redis", "to": "apps/web_console_ng", "type": "event", "label": "positions/orders"},
    {"from": "apps/alert_worker", "to": "ext_redis", "type": "data_flow", "label": "alert events"},
    {"from": "libs/trading", "to": "ext_redis", "type": "data_flow", "label": "circuit breaker state"}
  ],

  "filtering": {
    "hide_to_common_libs": true,
    "common_libs": ["libs/core/common", "libs/platform/secrets", "libs/core/health"],
    "allowlist": [
      "apps/execution_gateway",
      "apps/signal_service",
      "apps/orchestrator",
      "libs/trading",
      "libs/core"
    ]
  },

  "rendering": {
    "flow_diagram": {"output": "system_map_flow.md"},
    "deps_diagram": {"output": "system_map_deps.md"},
    "canvas": {"output": "system_map.canvas"}
  }
}
