upstream nicegui_cluster {
    # Option A: ip_hash (open-source nginx) - routes same IP to same backend
    ip_hash;

    # Option B: sticky cookie (requires nginx-sticky-module-ng or NGINX Plus)
    # sticky cookie nicegui_server_id expires=1h path=/ httponly secure;

    # Backend pods
    server nicegui-1:8080 max_fails=3 fail_timeout=30s;
    server nicegui-2:8080 max_fails=3 fail_timeout=30s;
    server nicegui-3:8080 max_fails=3 fail_timeout=30s;

    # Keepalive connections
    keepalive 32;
}

# k8s Ingress alternative (if using nginx-ingress controller):
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   annotations:
#     nginx.ingress.kubernetes.io/affinity: "cookie"
#     nginx.ingress.kubernetes.io/session-cookie-name: "nicegui_server_id"
#     nginx.ingress.kubernetes.io/session-cookie-expires: "3600"
#     nginx.ingress.kubernetes.io/session-cookie-secure: "true"
#     nginx.ingress.kubernetes.io/session-cookie-samesite: "Lax"
